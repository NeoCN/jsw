<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>API Overview</title>
</head>
<body bgcolor="#ffffff" marginheight="4" marginwidth="4" leftmargin="4" topmargin="4" alink="#023264" vlink="#023264" link="#525D76" text="#000000">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top"><a href="http://www.tanukisoftware.org/"><img src="images/TanukiSoftwareOrgLogo.png" border="0" vspace="0" hspace="0"></a></td><td bgcolor="#ffffff" align="right" valign="bottom" width="100%"><font color="gray" face="arial,helvetica,sanserif" size="+3"><i><b>Java Service Wrapper</b></i></font></td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="gray" colspan="7"><img height="1" width="1" src="images/spacer.png"></td>
</tr>
<tr>
<td valign="top" width="5"><img height="1" width="5" src="images/spacer.png"></td><td nowrap="1" valign="top" width="150">
<br>
<font face="arial,helvetica,sanserif">
<br>
<br>
<font size="+1" color="#000000">Documentation</font>
<br>
<font size="-1">
<ul>
<li>
<a href="introduction.html"><font size="-1">Introduction</font></a>
</li>
<li>
<a href="example.html"><font size="-1">Example</font></a>
</li>
<li>
<a href="api-overview.html"><font size="-1">API Overview</font></a>
</li>
<li>
<a href="config-overview.html"><font size="-1">Configuration Overview</font></a>
</li>
<li>
<a href="launch-overview.html"><font size="-1">Launching Your Application</font></a>
</li>
<li>
<a href="release-notes.html"><font size="-1">Release Notes</font></a>
</li>
<li>
<a href="debugging.html"><font size="-1">Debugging Your Application</font></a>
</li>
<li>
<a href="samples.html"><font size="-1">Integration Samples</font></a>
</li>
<li>
<a href="faq.html"><font size="-1">FAQ</font></a>
</li>
<li>
<a href="troubleshooting.html"><font size="-1">Troubleshooting</font></a>
</li>
<li>
<a href="history.html"><font size="-1">Project History</font></a>
</li>
<li>
<a href="javadocs.html"><font size="-1">JavaDocs API</font></a>
</li>
</ul>
</font>
<br>
<br>
<font size="+1" color="#000000">Download</font>
<br>
<font size="-1">
<ul>
<li>
<a href="http://sourceforge.net/project/showfiles.php?group_id=39428"><font size="-1">Binaries</font></a>
</li>
<li>
<a href="http://sourceforge.net/project/showfiles.php?group_id=39428"><font size="-1">Source Code</font></a>
</li>
</ul>
</font>
<br>
<br>
<font size="+1" color="#000000">Get Involved</font>
<br>
<font size="-1">
<ul>
<li>
<a href="http://sourceforge.net/projects/wrapper/"><font size="-1">Source Forge</font></a>
</li>
<li>
<a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/wrapper/"><font size="-1">CVS Repository</font></a>
</li>
<li>
<a href="http://sourceforge.net/forum/?group_id=39428"><font size="-1">Public Forums</font></a>
</li>
<li>
<a href="http://sourceforge.net/tracker/?group_id=39428"><font size="-1">Issue Tracking</font></a>
</li>
<li>
<a href="authors.html"><font size="-1">Authors</font></a>
</li>
<li>
<a href="license.html"><font size="-1">License</font></a>
</li>
</ul>
</font>
<br>
<br>
                        Hosted by:<br>
<A href="http://sourceforge.net/projects/wrapper/"><IMG alt="SourceForge Logo" border="0" height="31" width="88" src="http://sourceforge.net/sflogo.php?group_id=39428"></A>
<br>
</font></td><td valign="top" width="2"><img height="1" width="2" src="images/spacer.png"></td><td bgcolor="gray" valign="top" width="1"><img height="1" width="1" src="images/spacer.png"></td><td valign="top" width="10"><img height="1" width="10" src="images/spacer.png"></td><td align="left" valign="top" width="*">
<br>
<title>API Overview</title>
<center>
<table width="80%">
<tr>
<td bgcolor="#F3DD61">
<br>
<center>
<b><font face="arial,helvetica,sanserif" color="#000000">API Overview</font></b>
</center>
<br>
</td>
</tr>
</table>
</center>
<br>
 
     

    
<div>
<a name="N400A2B"></a>
<table cellspacing="0" cellpadding="2" border="0" width="100%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+1"><b>Overview of the Wrapper's Java API</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
        
        
<p align="justify">
            The Java-side API for Wrapper is quite simple and can be run in one of three
            modes.
        </p>
        
<div>
<a name="N400A33"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>Using the WrapperSimpleApp class</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                The first is to use the WrapperSimpleApp class to launch your Java
                application with out any modifications.  This class handles all
                communication with the native wrapper and simply launches your
                application by calling its main method as would be done from the
                command line.
            </p>
            
<p align="justify">
                The drawback to this method is that when your service is stopped, it
                is killed as if the user had hit CTRL-C in the console.  This means
                that your application may not be able to shut itself down cleanly.
                One option that you have is to register a shutdown hook.  A shutdown
                hook is a thread that is run when a JVM shuts down normally.  See the
                java.lang.Runtime.addShutdownHook javadocs for more information.
            </p>
            
<p align="justify">
                The benefit is that almost any Java application will work as is using
                this class.  All you need to do is set the following properties in your
                wrapper.conf file.  They are described in detail in the
                <a href="config-overview.html">Configuration Overview</a>.
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre># Set the main class to be the WrapperSimpleApp
wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperSimpleApp

# Set the first application parameter to the name of the class whose main method
# is to be launched.  Additional parameters come after this one.
wrapper.app.parameter.1=com.widgetsrus.MyAppMain
wrapper.app.parameter.2=parameter1
wrapper.app.parameter.3=parameter2

# Be sure to set your classpath.
wrapper.java.classpath.1=../lib/wrapper.jar
wrapper.java.classpath.2=../lib/myapp.jar</pre>
</td>
</tr>
</table>
</p>
</div>
                In most cases, that should be it.  Your application can now be launched
                using the scripts found in the
                <a href="launch-overview.html">Launch Overview</a>.
            </p>
        
</font></td>
</tr>
</table>
</div>
<br>
        
<div>
<a name="N400A4E"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>Using the WrapperStartStopApp class</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                The second is to use the WrapperStartStopApp class to launch your
                Java application, once again, without any modifications.  This class
                is useful for applications which are designed to be shutdown externally.
                An example is Tomcat4, shown in the
                <a href="samples.html">Samples</a> section of this
                documentation.
            </p>
            
<p align="justify">
                The WrapperStartStopApp actually requires that two seperate Main classes
                be configured.  The first is to start the application, just like is done
                with the WrapperSimpleApp above.  The second class is used to stop the
                application.
            </p>
            
<p align="justify">
                The most common case is for applications which are modeled after unix
                services.  An application is launched and then it is killed using a
                command sent via a socket connection from another application instance.
            </p>
            
<p align="justify">
                This helper class was implemented is a way that does not require any
                special feature from the Wrapper or its configuration file.  Both
                the start and stop class, along with all of their parameters are
                specified in the parameters to the WrapperStartStopApp main method.
                In conjunction with the Wrapper, it will then make sure that the main
                method of the start class is called at startup, and that the main
                method of the stop class is called at shutdown.
            </p>
            
<p align="justify">
                To configure the Wrapper to use the WrapperStartStopApp to control your
                application, you must set the following properties in your wrapper.conf
                file.  They are described in detail in the
                <a href="config-overview.html">Configuration Overview</a>.
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre># Set the main class to be the WrapperStartStopApp
wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperStartStopApp

# Set the first application parameter to the name of the class whose main method
# is to be launched. The class is followed by the number of parameters to be passed
# to the main method.  Then the actual parameters.
wrapper.app.parameter.1=com.widgetsrus.MyAppStart
wrapper.app.parameter.2=2
wrapper.app.parameter.3=startparameter1
wrapper.app.parameter.4=startparameter2

# The start parameters are followed by the name of the class whose main method
# is to be called to stop the application.  The class is followed by a flag which
# controls whether or not the Wrapper should wait for all non daemon threads to
# complete before exiting the JVM.  The flag is followed by the number of
# parameters to be passed to the main method.  Then the actual parameters.
wrapper.app.parameter.5=com.widgetsrus.MyAppStop
wrapper.app.parameter.6=true
wrapper.app.parameter.7=1
wrapper.app.parameter.8=stopparameter1

# Be sure to set your classpath.
wrapper.java.classpath.1=../lib/wrapper.jar
wrapper.java.classpath.2=../lib/myapp.jar</pre>
</td>
</tr>
</table>
</p>
</div>
                That should be all that you have to do.  com.widgetsrus.MyAppStart.main will be
                called at startup and com.widgetsrus.MyAppStop.main will be called at shutdown.
            </p>
        
</font></td>
</tr>
</table>
</div>
<br>
        
<div>
<a name="N400A6F"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>Implement the WrapperListener interface</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                The third method is to have your application implement the
                WrapperListener interface.  This interface provides three methods
                used to inform your application when it should start and stop as well
                as when a system control event takes place (for example, the user
                hitting CTRL-C, or logging out under windows)
            </p>
            
<p align="justify">
                The WrapperListener class has the following methods.
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>public interface WrapperListener {
    /**
     * The start method is called when the WrapperManager is signaled by the 
     *	native wrapper code that it can start its application.  This
     *	method call is expected to return, so a new thread should be launched
     *	if necessary.
     * If there are any problems, then an Integer should be returned, set to
     *	the desired exit code.  If the application should continue,
     *	return null.
     */
    Integer start(String[] args);
    
    /**
     * Called when the application is shutting down.  The Wrapper assumes that
     *  this method will return fairly quickly.  If the shutdown code code
     *  could potentially take a long time, then WrapperManager.stopping()
     *  should be called to extend the timeout period.  If for some reason,
     *  the stop method can not return, then it must call
     *  WrapperManager.stopped() to avoid warning messages from the Wrapper.
     *
     * @param exitCode The suggested exit code that will be returned to the OS
     *                 when the JVM exits.
     *
     * @return The exit code to actually return to the OS.  In most cases, this
     *         should just be the value of exitCode, however the user code has
     *         the option of changing the exit code if there are any problems
     *         during shutdown.
     */
    int stop(int exitCode);
    
    /**
     * Called whenever the native wrapper code traps a system control signal
     *  against the Java process.  It is up to the callback to take any actions
     *  necessary.  Possible values are: WrapperManager.WRAPPER_CTRL_C_EVENT, 
     *    WRAPPER_CTRL_CLOSE_EVENT, WRAPPER_CTRL_LOGOFF_EVENT, or 
     *    WRAPPER_CTRL_SHUTDOWN_EVENT
     */
    void controlEvent(int event);
}</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
            
<p align="justify">
                An application implementing the WrapperListener should not directly
                start the application in the main method.  Everything that would
                normally be in the main method should be moved into the start method.
            </p>
            
<p align="justify">
                The main method should simply contain the following code:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>public class MyApp implements WrapperListener {
    ... Application methods ...
    ... WrapperListener methods...

    public static void main(String[] args) {
        // Start the application.  If the JVM was launched from the native
        //  Wrapper then the application will wait for the native Wrapper to
        //  call the application's start method.  Otherwise the start method
        //  will be called immediately.
        WrapperManager.start(new MyApp(), args);
    }
}</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
        
</font></td>
</tr>
</table>
</div>
<br>
        
<div>
<a name="N400A89"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>API Available to Your Application</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                It is often necessary for your application to control its own lifecycle
                as a service.  This includes requesting that your application be stopped
                or restarted.
            </p>
            
<p align="justify">
                The Java Service Wrapper allows your application access to the Wrapper
                via the WrapperManager class.
            </p>
            
<p align="justify">
                Please see the <a href="javadocs.html">JavaDocs</a> for details.
            </p>
        
</font></td>
</tr>
</table>
</div>
<br>
    
</font></td>
</tr>
</table>
</div>
<br> 

</td><td valign="top" width="5"><img height="1" width="5" src="images/spacer.png"></td>
</tr>
<tr>
<td bgcolor="gray" colspan="7"><img height="1" width="1" src="images/spacer.png"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td align="left"><font color="#525D76" size="-1" face="arial,helvetica,sanserif"><i>
                            Copyright &copy;1999-2003 by TanukiSoftware.org.
                            All Rights Reserved.
                        </i></font></td><td align="right"><font color="#525D76" size="-1" face="arial,helvetica,sanserif"><i>
                            last modified:
                            <script language="JavaScript">
                                <!-- 
                                document.write(document.lastModified); 
                                //  -->
                            </script></i></font></td>
</tr>
</table>
</body>
</html>
