<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Tomcat 4 Integration Sample</title>
</head>
<body bgcolor="#ffffff" marginheight="4" marginwidth="4" leftmargin="4" topmargin="4" alink="#023264" vlink="#023264" link="#525D76" text="#000000">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top"><a href="http://www.tanukisoftware.org/"><img src="images/TanukiSoftwareOrgLogo.png" border="0" vspace="0" hspace="0"></a></td><td bgcolor="#ffffff" align="right" valign="bottom" width="100%"><font color="gray" face="arial,helvetica,sanserif" size="+3"><i><b>Java Service Wrapper</b></i></font></td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="gray" colspan="7"><img height="1" width="1" src="images/spacer.png"></td>
</tr>
<tr>
<td valign="top" width="5"><img height="1" width="5" src="images/spacer.png"></td><td nowrap="1" valign="top" width="150">
<br>
<font face="arial,helvetica,sanserif">
<center>
<img border="0" src="images/DukeTowel.png"></center>
<br>
<font size="+1" color="#000000">Documentation</font>
<br>
<font size="-1">
<ul>
<li>
<a href="introduction.html"><font size="-1">Introduction</font></a>
</li>
<li>
<a href="example.html"><font size="-1">Example</font></a>
</li>
<li>
<a href="api-overview.html"><font size="-1">API Overview</font></a>
</li>
<li>
<a href="config-overview.html"><font size="-1">Configuration Overview</font></a>
</li>
<li>
<a href="launch-overview.html"><font size="-1">Launching Your Application</font></a>
</li>
<li>
<a href="release-notes.html"><font size="-1">Release Notes</font></a>
</li>
<li>
<a href="debugging.html"><font size="-1">Debugging Your Application</font></a>
</li>
<li>
<a href="samples.html"><font size="-1">Integration Samples</font></a>
</li>
<li>
<a href="faq.html"><font size="-1">FAQ</font></a>
</li>
<li>
<a href="troubleshooting.html"><font size="-1">Troubleshooting</font></a>
</li>
<li>
<a href="history.html"><font size="-1">Project History</font></a>
</li>
<li>
<a href="javadocs.html"><font size="-1">JavaDocs API</font></a>
</li>
</ul>
</font>
<br>
<br>
<font size="+1" color="#000000">Download</font>
<br>
<font size="-1">
<ul>
<li>
<a href="http://sourceforge.net/project/showfiles.php?group_id=39428"><font size="-1">Binaries</font></a>
</li>
<li>
<a href="http://sourceforge.net/project/showfiles.php?group_id=39428"><font size="-1">Source Code</font></a>
</li>
</ul>
</font>
<br>
<br>
<font size="+1" color="#000000">Get Involved</font>
<br>
<font size="-1">
<ul>
<li>
<a href="http://sourceforge.net/projects/wrapper/"><font size="-1">Source Forge</font></a>
</li>
<li>
<a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/wrapper/"><font size="-1">CVS Repository</font></a>
</li>
<li>
<a href="http://sourceforge.net/forum/?group_id=39428"><font size="-1">Public Forums</font></a>
</li>
<li>
<a href="http://sourceforge.net/tracker/?group_id=39428"><font size="-1">Issue Tracking</font></a>
</li>
<li>
<a href="authors.html"><font size="-1">Authors</font></a>
</li>
<li>
<a href="license.html"><font size="-1">License</font></a>
</li>
</ul>
</font>
<br>
<br>
                        Hosted by:<br>
<A href="http://sourceforge.net/projects/wrapper/"><IMG alt="SourceForge Logo" border="0" height="31" width="88" src="http://sourceforge.net/sflogo.php?group_id=39428"></A>
<br>
</font></td><td valign="top" width="2"><img height="1" width="2" src="images/spacer.png"></td><td bgcolor="gray" valign="top" width="1"><img height="1" width="1" src="images/spacer.png"></td><td valign="top" width="10"><img height="1" width="10" src="images/spacer.png"></td><td align="left" valign="top" width="*">
<br>
<title>Tomcat 4 Integration Sample</title>
<center>
<table width="80%">
<tr>
<td bgcolor="#F3DD61">
<br>
<center>
<b><font face="arial,helvetica,sanserif" color="#000000">Tomcat 4 Integration Sample</font></b>
</center>
<br>
</td>
</tr>
</table>
</center>
<br>
 
     

    
<div>
<a name="N400A2B"></a>
<table cellspacing="0" cellpadding="2" border="0" width="100%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+1"><b>How to integrate the Wrapper with Tomcat 4</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
        
        
<p align="justify">
            Tomcat is normally run by executing startup.bat or startup.sh script to launch
            the server and then executing shutdown.bat or shutdown.sh to stop the server.
            This type of application is what the WrapperStartStopApp helper class was
            designed for.
        </p>
        
<div>
<a name="N400A33"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>Installing the Wrapper files</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                Download the latest version of the Wrapper and uncompress the archive into
                the directory of your choice.  Do the same with Tomcat.
            </p>
            
<div>
<a name="N400A3B"></a>
<table cellspacing="0" cellpadding="2" border="0" width="98%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="-1"><b>Windows files</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
                
                
<p align="justify">
                    Copy the Wrapper.exe file from the {wrapper.home}/bin directory
                    into the {tomcat.home}/bin directory.  Template batch files are
                    available in {wrapper.home}/src/bin.  Copy the files App.bat.in,
                    InstallApp-NT.bat.in and UninstallApp-NT.bat.in into the
                    {tomcat.home}/bin directory, renaming them as follows:
                    Tomcat.bat, InstallTomcat-NT.bat, and UninstallTomcat-NT.bat.
                </p>
                
<p align="justify">
                    Next, copy the required library files, Wrapper.DLL and wrapper.jar,
                    from the {wrapper.home}/lib directory into the {tomcat.home}/lib
                    directory.
                </p>
                
<p align="justify">
                    Finally, copy the template wrapper configuration file wrapper.conf.in
                    from the {wrapper.home}/src/conf directory into the
                    {tomcat.home}/conf directory, renaming it to wrapper.conf.  We will
                    go over required modifications to wrapper.conf below.
                </p>
            
</font></td>
</tr>
</table>
</div>
<br>
            
<div>
<a name="N400A4A"></a>
<table cellspacing="0" cellpadding="2" border="0" width="98%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="-1"><b>Linux / Solaris files</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
                
                
<p align="justify">
                    Copy the wrapper and realpath binaries from the {wrapper.home}/bin
                    directory into the {tomcat.home}/bin directory.  Copy the template
                    script file from the {wrapper.home}/src/bin directory into the
                    {tomcat.home}/bin directory, renaming it to tomcat.sh.  There are
                    two script files available.  The first, bash.script.in should usually
                    be used for Linux.  sh.script.in should be used for Solaris.
                    Make sure that the executable permission is set for all 3 files.
                </p>
                
<p align="justify">
                    Edit the tomcat.sh file.  Towards the top of the file, you will find
                    two tokens which need to be replaced.  Replace the token "@app.name@"
                    with "tomcat", and "@app.long.name@" with "Tomcat 4 Server".  No
                    other changes should be necessary.
                </p>
                
<p align="justify">
                    Next, copy the required library files, libwrapper.so and wrapper.jar,
                    from the {wrapper.home}/lib directory into the {tomcat.home}/lib
                    directory.
                </p>
                
<p align="justify">
                    Finally, copy the template wrapper configuration file wrapper.conf.in
                    from the {wrapper.home}/src/conf directory into the
                    {tomcat.home}/conf directory, renaming it to wrapper.conf.  We will
                    go over required modifications to wrapper.conf below.
                </p>
            
</font></td>
</tr>
</table>
</div>
<br>
        
</font></td>
</tr>
</table>
</div>
<br>
        
<div>
<a name="N400A5D"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>Setting up the wrapper.conf file</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                The scripts that come with Tomcat are a bit complicated so that they will
                work under all circumstances.  In order to figure out how to configure
                the Wrapper to launch Tomcat.  You need to first figure out what the
                actual command is that launches Tomcat.  You can do this on Windows by
                commenting out the @echo off at the top of the batch file.  The same can
                be done on unix by echoing the command to the console just before it is
                executed..
            </p>
            
<p align="justify">
                On windows, the command used to launch Tomcat is as follows (The command
                is actually all on one line):
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>"D:\Sun\j2sdk1.4.0\bin\java"
  -Djava.endorsed.dirs="..\bin;..\common\lib"
  -classpath "D:\Sun\j2sdk1.4.0\lib\tools.jar;..\bin\bootstrap.jar"
  -Dcatalina.base=".." -Dcatalina.home=".." -Djava.io.tmpdir="..\temp"
  org.apache.catalina.startup.Bootstrap  start</pre>
</td>
</tr>
</table>
</p>
</div>
                It turns out that the shutdown script is exactly the same command.  The
                only difference is that the application parameter "start" is replaced
                with "stop".
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>"D:\Sun\j2sdk1.4.0\bin\java"
  -Djava.endorsed.dirs="..\bin;..\common\lib"
  -classpath "D:\Sun\j2sdk1.4.0\lib\tools.jar;..\bin\bootstrap.jar"
  -Dcatalina.base=".." -Dcatalina.home=".." -Djava.io.tmpdir="..\temp"
  org.apache.catalina.startup.Bootstrap  stop</pre>
</td>
</tr>
</table>
</p>
</div>
                The script resolves all absolute paths.  To make this example more
                portable, we will modify the absolute paths to be relative to the bin
                directory, where the Wrapper binary is located.  We will also assume
                that java can be found on the system path.
            </p>
            
<p align="justify">
                Breaking up the commands above, there are several things to look for.
                The first is the command used to launch the JVM.  If the above command,
                this is "D:\Sun\j2sdk1.4.0\bin\java".  Assume that the java command is
                available on the path, the following property needs to be set in the
                wrapper.conf file:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.java.command=java</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
            
<p align="justify">
                The next step is to setup the classpath.  To make the configuration
                portable, the Wrapper requires that each classpath element be set as a
                different property. It is also necessary to include the wrapper.jar
                file.  If you are using JSP, then Tomcat requires that the tools.jar
                file, included with the JDK, be included in the classpath as well.
                You can either set the classpath to point to the location of the jar
                in the JDK, or copy it into tomcat's tools directory.  Here we assume
                the later.  The classpath should be set as follows in the wrapper.conf
                file:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.java.classpath.1=../lib/wrapper.jar
wrapper.java.classpath.2=../lib/tools.jar
wrapper.java.classpath.3=../bin/bootstrap.jar</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
            
<p align="justify">
                The Wrapper will need to be able to locate its native library.  This
                should already be set in the default wrapper.conf file, but make sure
                that the following property is set:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.java.library.path=../lib</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
            
<p align="justify">
                Tomcat requires a number of properties be set when the JVM is launched.
                These are set as follows:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.java.additional.1=-Djava.endorsed.dirs="../bin;../common/endorsed"
wrapper.java.additional.2=-Dcatalina.base=".."
wrapper.java.additional.3=-Dcatalina.home=".."
wrapper.java.additional.4=-Djava.io.tmpdir="../temp"</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
            
<p align="justify">
                Next the class used to launch Tomcat must be specified.  In the commands
                above, this is org.apache.catalina.startup.Bootstrap.  However we will
                be relying on a helper class to control the life cycle of Tomcat.  Set
                the main class as follows:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperStartStopApp</pre>
</td>
</tr>
</table>
</p>
</div>
                The WrapperStartStopApp still needs to be told how to start and stop
                Tomcat.  This is done by passing parameters to the class when it is
                started.  Set the application parameters as follows:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.app.parameter.1=org.apache.catalina.startup.Bootstrap
wrapper.app.parameter.2=1
wrapper.app.parameter.3=start
wrapper.app.parameter.4=org.apache.catalina.startup.Bootstrap
wrapper.app.parameter.5=true
wrapper.app.parameter.6=1
wrapper.app.parameter.7=stop</pre>
</td>
</tr>
</table>
</p>
</div>
                The Bootstrap class is used to both start and stop Tomcat.  In each case,
                a single parameter is passed in. "start" to start Tomcat, and "stop" to
                stop it.  When stopping Tomcat, the "true" flag specifies that the JVM
                should not exit until all non daemon threads have completed.
            </p>
            
<p align="justify">
                The last step is to set the name of the pid file to use, for unix
                systems, and the name and description of the NT Service, for Windows
                systems:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.pidfile=/var/run/tomcat.pid
wrapper.ntservice.name=tomcat
wrapper.ntservice.displayname=Tomcat 4 Server
wrapper.ntservice.description=Tomcat 4 Server</pre>
</td>
</tr>
</table>
</p>
</div>
                If you applications make use of a database, then on Windows systems, you
                should also make sure that the database is always started before Tomcat
                when running as a service:
                <div align="left">
<p>
<table cellspacing="2" cellpadding="2" border="0" width="100%" bgcolor="#eeeeee">
<tr>
<td>
<pre>wrapper.ntservice.dependency.1=MySQL</pre>
</td>
</tr>
</table>
</p>
</div>
            
</p>
        
</font></td>
</tr>
</table>
</div>
<br>
        
<div>
<a name="N400AA3"></a>
<table cellspacing="0" cellpadding="2" border="0" width="99%">
<tr>
<td bgcolor="#525D76"><font face="arial,helvetica,sanserif" color="#ffffff" size="+0"><b>Testing the configuration</b></font></td>
</tr>
<tr>
<td><font face="arial,helvetica,sanserif" color="#000000">
<br>
            
            
<p align="justify">
                You should now be able to run Tomcat using the scripts we installed
                above. See the <a href="launch-overview.html">Launch Overview</a>
                section for an explanation of how the scripts work.  On NT, make sure
                that the installation works as a console application before attempting
                to run as a service.
            </p>
            
<p align="justify">
                If you find any problems with this sample, please let us know so we can
                get them fixed.
            </p>
        
</font></td>
</tr>
</table>
</div>
<br>
    
</font></td>
</tr>
</table>
</div>
<br> 

</td><td valign="top" width="5"><img height="1" width="5" src="images/spacer.png"></td>
</tr>
<tr>
<td bgcolor="gray" colspan="7"><img height="1" width="1" src="images/spacer.png"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td align="left"><font color="#525D76" size="-1" face="arial,helvetica,sanserif"><i>
                            Copyright &copy;1999-2003 by TanukiSoftware.org.
                            All Rights Reserved.
                        </i></font></td><td align="right"><font color="#525D76" size="-1" face="arial,helvetica,sanserif"><i>
                            last modified:
                            <script language="JavaScript">
                                <!-- 
                                document.write(document.lastModified); 
                                //  -->
                            </script></i></font></td>
</tr>
</table>
</body>
</html>
